{% extends "layouts/base.html" %}

{% block title %}داشبورد مدیریت | HoseinProxy{% endblock %}

{% block content %}
<!-- فونت وزیرمتن -->
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />

<style>
    :root {
        --bg-dark: #0f172a;
        --card-bg: rgba(15, 23, 42, 0.65);
        --card-border: rgba(255, 255, 255, 0.08);
        --card-hover-border: rgba(139, 92, 246, 0.4);
        --text-primary: #f1f5f9;
        --text-secondary: #94a3b8;
        --accent-primary: #8b5cf6;
        --success: #10b981;
        --danger: #ef4444;
        --warning: #f59e0b;
        --info: #06b6d4;
        --glass-shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
    }

    body {
        font-family: 'Vazirmatn', sans-serif !important;
        background-color: var(--bg-dark) !important;
        color: var(--text-primary) !important;
        overflow-x: hidden;
    }

    #starfield {
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        z-index: -1;
        background: radial-gradient(circle at 50% 0%, #1e293b 0%, #020617 80%);
        pointer-events: none;
    }

    /* Professional Glass Card */
    .glass-card {
        background: var(--card-bg);
        backdrop-filter: blur(16px);
        -webkit-backdrop-filter: blur(16px);
        border: 1px solid var(--card-border);
        border-radius: 20px;
        box-shadow: var(--glass-shadow);
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        overflow: hidden;
        position: relative;
    }

    .glass-card:hover {
        border-color: var(--card-hover-border);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.35);
        transform: translateY(-4px);
    }

    .glass-card::before {
        content: '';
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
        pointer-events: none;
        border-radius: 20px;
    }

    /* Enhanced Buttons */
    .btn-glow {
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
        border: none;
        font-weight: 600;
        letter-spacing: 0.5px;
    }

    .btn-glow::before {
        content: '';
        position: absolute;
        top: 0; left: -100%;
        width: 100%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        transition: left 0.5s;
    }

    .btn-glow:hover::before {
        left: 100%;
    }

    .btn-primary-glow {
        background: linear-gradient(135deg, var(--accent-primary), #7c3aed);
        box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
    }

    .btn-primary-glow:hover {
        box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);
        transform: translateY(-2px);
    }

    .btn-success-glow {
        background: linear-gradient(135deg, var(--success), #059669);
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
    }

    .btn-success-glow:hover {
        box-shadow: 0 6px 20px rgba(16, 185, 129, 0.6);
        transform: translateY(-2px);
    }

    .btn-danger-glow {
        background: linear-gradient(135deg, var(--danger), #dc2626);
        box-shadow: 0 4px 15px rgba(239, 68, 68, 0.4);
    }

    .btn-danger-glow:hover {
        box-shadow: 0 6px 20px rgba(239, 68, 68, 0.6);
        transform: translateY(-2px);
    }

    /* Enhanced Tables */
    .table-dark-custom {
        background: transparent !important;
        border-radius: 16px;
        overflow: hidden;
    }

    .table-dark-custom thead th {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(124, 58, 237, 0.1));
        border: none;
        color: var(--text-primary);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.85rem;
        padding: 1rem 0.75rem;
    }

    .table-dark-custom tbody tr {
        background: rgba(15, 23, 42, 0.4);
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
    }

    .table-dark-custom tbody tr:hover {
        background: rgba(15, 23, 42, 0.6);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .table-dark-custom td {
        border: none;
        padding: 0.75rem;
        vertical-align: middle;
        color: var(--text-secondary);
    }

    /* Status Indicators */
    .status-indicator {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 500;
        backdrop-filter: blur(10px);
    }

    .status-running {
        background: rgba(16, 185, 129, 0.2);
        color: var(--success);
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .status-stopped {
        background: rgba(239, 68, 68, 0.2);
        color: var(--danger);
        border: 1px solid rgba(239, 68, 68, 0.3);
    }

    /* Modern Forms */
    .form-control-modern {
        background: rgba(15, 23, 42, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 12px;
        color: var(--text-primary);
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
    }

    .form-control-modern:focus {
        background: rgba(15, 23, 42, 0.7);
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 0.2rem rgba(139, 92, 246, 0.25);
        color: var(--text-primary);
    }

    /* Modal Enhancements */
    .modal-content-glass {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--card-border);
        border-radius: 24px;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    }

    .modal-header-glass {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), transparent);
        border-radius: 24px 24px 0 0;
    }

    /* Card Headers */
    .card-header-glass {
        background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), transparent);
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 20px 20px 0 0 !important;
        padding: 1.5rem;
    }

    /* Proxy Type Badges */
    .proxy-type-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .proxy-type-standard {
        background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(8, 145, 178, 0.1));
        color: var(--info);
        border: 1px solid rgba(6, 182, 212, 0.3);
    }

    .proxy-type-tls {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.1));
        color: var(--success);
        border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .proxy-type-dd {
        background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.1));
        color: var(--warning);
        border: 1px solid rgba(245, 158, 11, 0.3);
    }

    /* Loading Animation */
    .loading-spinner {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top: 2px solid var(--accent-primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Responsive Enhancements */
    @media (max-width: 768px) {
        .glass-card {
            margin-bottom: 1rem;
        }
        
        .btn-glow {
            width: 100%;
            margin-bottom: 0.5rem;
        }
    }
</style>

<!-- ستاره‌های پس‌زمینه -->
<div id="starfield"></div>

<!-- محتوای اصلی -->
<div class="container-fluid px-4 py-5">
    <!-- هدر داشبورد -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="glass-card p-4">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
                    <div>
                        <h1 class="h3 mb-1 fw-bold text-primary">داشبورد مدیریت پروکسی</h1>
                        <p class="text-muted mb-0">مدیریت کامل سرورهای MTProto با پشتیبانی FakeTLS</p>
                    </div>
                    <div class="d-flex gap-2 flex-wrap">
                        <button class="btn btn-primary-glow btn-glow" data-bs-toggle="modal" data-bs-target="#addProxyModal">
                            <i class="fas fa-plus me-2"></i>افزودن پروکسی
                        </button>
                        <button class="btn btn-success-glow btn-glow" data-bs-toggle="modal" data-bs-target="#addFakeTLSModal">
                            <i class="fas fa-shield-alt me-2"></i>پروکسی FakeTLS
                        </button>
                        <a href="{{ url_for('tools.bulk_create') }}" class="btn btn-info btn-glow">
                            <i class="fas fa-layer-group me-2"></i>ساخت گروهی
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- آمار کلی -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="glass-card p-4 text-center">
                <div class="d-flex align-items-center justify-content-center mb-3">
                    <div class="bg-primary bg-opacity-20 rounded-3 p-3 me-3">
                        <i class="fas fa-server fa-2x text-primary"></i>
                    </div>
                    <div>
                        <h3 class="h2 fw-bold text-primary mb-0">{{ proxies|length }}</h3>
                        <p class="text-muted mb-0">کل پروکسی‌ها</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="glass-card p-4 text-center">
                <div class="d-flex align-items-center justify-content-center mb-3">
                    <div class="bg-success bg-opacity-20 rounded-3 p-3 me-3">
                        <i class="fas fa-check-circle fa-2x text-success"></i>
                    </div>
                    <div>
                        <h3 class="h2 fw-bold text-success mb-0">{{ running_count }}</h3>
                        <p class="text-muted mb-0">فعال</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="glass-card p-4 text-center">
                <div class="d-flex align-items-center justify-content-center mb-3">
                    <div class="bg-warning bg-opacity-20 rounded-3 p-3 me-3">
                        <i class="fas fa-shield-alt fa-2x text-warning"></i>
                    </div>
                    <div>
                        <h3 class="h2 fw-bold text-warning mb-0">{{ tls_count }}</h3>
                        <p class="text-muted mb-0">FakeTLS</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="glass-card p-4 text-center">
                <div class="d-flex align-items-center justify-content-center mb-3">
                    <div class="bg-info bg-opacity-20 rounded-3 p-3 me-3">
                        <i class="fas fa-users fa-2x text-info"></i>
                    </div>
                    <div>
                        <h3 class="h2 fw-bold text-info mb-0">{{ total_users }}</h3>
                        <p class="text-muted mb-0">کاربران</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- جدول پروکسی‌ها -->
    <div class="row">
        <div class="col-12">
            <div class="glass-card">
                <div class="card-header-glass">
                    <h5 class="mb-0 fw-bold">
                        <i class="fas fa-list me-2"></i>لیست پروکسی‌ها
                    </h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-dark-custom table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>شناسه</th>
                                    <th>نام</th>
                                    <th>نوع</th>
                                    <th>پورت</th>
                                    <th>دامنه</th>
                                    <th>وضعیت</th>
                                    <th>کاربران</th>
                                    <th>دانلود</th>
                                    <th>آپلود</th>
                                    <th>حجم مصرفی</th>
                                    <th>عملیات</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for proxy in proxies %}
                                <tr>
                                    <td>{{ proxy.id }}</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="bg-primary bg-opacity-20 rounded-3 p-2 me-2">
                                                <i class="fas fa-server text-primary"></i>
                                            </div>
                                            <div>
                                                <div class="fw-bold">{{ proxy.name or 'پروکسی ' + proxy.id|string }}</div>
                                                <small class="text-muted">{{ proxy.created_at|timesince }} پیش</small>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="proxy-type-badge proxy-type-{{ proxy.proxy_type }}">
                                            {% if proxy.proxy_type == 'standard' %}استاندارد{% endif %}
                                            {% if proxy.proxy_type == 'tls' %}FakeTLS{% endif %}
                                            {% if proxy.proxy_type == 'dd' %}DD{% endif %}
                                        </span>
                                    </td>
                                    <td><span class="badge bg-primary">{{ proxy.port }}</span></td>
                                    <td>
                                        {% if proxy.tls_domain %}
                                            <span class="badge bg-success">{{ proxy.tls_domain }}</span>
                                        {% else %}
                                            <span class="text-muted">-</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="status-indicator status-{{ proxy.status }}">
                                            <i class="fas fa-circle"></i>
                                            {% if proxy.status == 'running' %}فعال{% endif %}
                                            {% if proxy.status == 'stopped' %}متوقف{% endif %}
                                        </span>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary">{{ proxy.active_connections or 0 }}</span>
                                    </td>
                                    <td><span class="text-success">{{ proxy.download|filesize }}</span></td>
                                    <td><span class="text-info">{{ proxy.upload|filesize }}</span></td>
                                    <td>
                                        {% if proxy.quota_bytes > 0 %}
                                            <div class="d-flex align-items-center gap-2">
                                                <span>{{ proxy.quota_usage|filesize }} / {{ proxy.quota_bytes|filesize }}</span>
                                                <div class="progress flex-grow-1" style="height: 6px;">
                                                    <div class="progress-bar {% if proxy.quota_percent > 80 %}bg-danger{% elif proxy.quota_percent > 60 %}bg-warning{% else %}bg-success{% endif %}" 
                                                         style="width: {{ proxy.quota_percent }}%"></div>
                                                </div>
                                            </div>
                                        {% else %}
                                            <span class="text-muted">نامحدود</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            {% if proxy.status == 'running' %}
                                                <button class="btn btn-sm btn-warning btn-glow" onclick="stopProxy({{ proxy.id }})" title="Stop">
                                                    <i class="fas fa-stop"></i>
                                                </button>
                                                <button class="btn btn-sm btn-info btn-glow" onclick="restartProxy({{ proxy.id }})" title="Restart">
                                                    <i class="fas fa-sync"></i>
                                                </button>
                                            {% else %}
                                                <button class="btn btn-sm btn-success btn-glow" onclick="startProxy({{ proxy.id }})" title="Start">
                                                    <i class="fas fa-play"></i>
                                                </button>
                                            {% endif %}
                                            <button class="btn btn-sm btn-primary btn-glow" onclick="editProxy({{ proxy.id }})" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger btn-glow" onclick="deleteProxy({{ proxy.id }})" title="Delete">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                            {% if proxy.proxy_type == 'tls' %}
                                                <button class="btn btn-sm btn-warning btn-glow" onclick="viewFakeTLSLogs({{ proxy.id }})" title="Logs">
                                                    <i class="fas fa-file-alt"></i>
                                                </button>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% else %}
                                <tr>
                                    <td colspan="11" class="text-center py-4">
                                        <div class="text-muted">
                                            <i class="fas fa-inbox fa-3x mb-3 opacity-50"></i>
                                            <p>هیچ پروکسی یافت نشد</p>
                                            <button class="btn btn-primary-glow btn-glow mt-2" data-bs-toggle="modal" data-bs-target="#addProxyModal">
                                                <i class="fas fa-plus me-2"></i>ساخت اولین پروکسی
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal برای افزودن پروکسی معمولی -->
<div class="modal fade" id="addProxyModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content modal-content-glass">
            <div class="modal-header modal-header-glass">
                <h5 class="modal-title fw-bold">
                    <i class="fas fa-plus me-2"></i>افزودن پروکسی جدید
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('proxy.add') }}">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">پورت</label>
                            <input type="number" name="port" class="form-control form-control-modern" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">نام پروکسی</label>
                            <input type="text" name="name" class="form-control form-control-modern" placeholder="اختیاری">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">سکرت</label>
                            <input type="text" name="secret" class="form-control form-control-modern" placeholder="خالی بگذارید برای تولید خودکار">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">تعداد وورکرها</label>
                            <input type="number" name="workers" class="form-control form-control-modern" value="2" min="1" max="16">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">تگ تبلیغاتی</label>
                            <input type="text" name="tag" class="form-control form-control-modern" placeholder="اختیاری">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">نوع پروکسی</label>
                            <select name="proxy_type" class="form-select form-control-modern">
                                <option value="standard">استاندارد</option>
                                <option value="dd">DD</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">حجم مجاز (GB)</label>
                            <input type="number" name="quota_gb" class="form-control form-control-modern" placeholder="0 برای نامحدود" step="0.1">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">اعتبار (روز)</label>
                            <input type="number" name="expiry_days" class="form-control form-control-modern" placeholder="0 برای دائمی">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-glow" data-bs-dismiss="modal">انصراف</button>
                    <button type="submit" class="btn btn-primary-glow btn-glow">
                        <i class="fas fa-plus me-2"></i>افزودن پروکسی
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal برای افزودن پروکسی FakeTLS -->
<div class="modal fade" id="addFakeTLSModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content modal-content-glass">
            <div class="modal-header modal-header-glass">
                <h5 class="modal-title fw-bold">
                    <i class="fas fa-shield-alt me-2"></i>افزودن پروکسی FakeTLS
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('proxy_enhanced.create_faketls') }}">
                <div class="modal-body">
                    <div class="alert alert-info alert-glass">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>FakeTLS</strong> ترافیک پروکسی را به صورت HTTPS معمولی جلوه می‌دهد و مقاومت آن در برابر فیلترینگ را افزایش می‌دهد.
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">پورت</label>
                            <input type="number" name="port" class="form-control form-control-modern" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">نام پروکسی</label>
                            <input type="text" name="name" class="form-control form-control-modern" placeholder="اختیاری">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">سکرت</label>
                            <input type="text" name="secret" class="form-control form-control-modern" placeholder="خالی بگذارید برای تولید خودکار">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">تعداد وورکرها</label>
                            <input type="number" name="workers" class="form-control form-control-modern" value="4" min="1" max="16">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">دامنه FakeTLS</label>
                            <select name="domain_choice" class="form-select form-control-modern" required>
                                <option value="1">google.com (پیشنهادی - بیشترین اعتبار)</option>
                                <option value="2">cloudflare.com (مناسب برای محیط‌های فنی)</option>
                                <option value="3">microsoft.com (مناسب برای شبکه‌های سازمانی)</option>
                                <option value="4">apple.com (مناسب برای کاربران iOS/macOS)</option>
                                <option value="5">amazon.com (ترافیک تجارت الکترونیک)</option>
                                <option value="6">facebook.com (ترافیک شبکه‌های اجتماعی)</option>
                                <option value="7">twitter.com (ترافیک شبکه‌های اجتماعی)</option>
                                <option value="8">instagram.com (ترافیک شبکه‌های اجتماعی)</option>
                                <option value="9">whatsapp.com (ترافیک پیام‌رسان)</option>
                                <option value="10">telegram.org (ترافیک پیام‌رسان)</option>
                                <option value="11">cdn.discordapp.com (بازی/ارتباطات)</option>
                                <option value="12">cdn.cloudflare.com (ترافیک CDN)</option>
                                <option value="13">ajax.googleapis.com (APIهای Google)</option>
                                <option value="14">fonts.googleapis.com (فونت‌های وب)</option>
                                <option value="15">apis.google.com (APIهای Google)</option>
                                <option value="16">ssl.gstatic.com (محتوای استاتیک Google)</option>
                                <option value="17">www.gstatic.com (محتوای استاتیک Google)</option>
                                <option value="18">accounts.google.com (احراز هویت Google)</option>
                                <option value="19">drive.google.com (Google Drive)</option>
                                <option value="20">docs.google.com (Google Docs)</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">تگ تبلیغاتی</label>
                            <input type="text" name="tag" class="form-control form-control-modern" placeholder="اختیاری">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">حجم مجاز (GB)</label>
                            <input type="number" name="quota_gb" class="form-control form-control-modern" placeholder="0 برای نامحدود" step="0.1">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">اعتبار (روز)</label>
                            <input type="number" name="expiry_days" class="form-control form-control-modern" placeholder="0 برای دائمی">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary btn-glow" data-bs-dismiss="modal">انصراف</button>
                    <button type="submit" class="btn btn-success-glow btn-glow">
                        <i class="fas fa-shield-alt me-2"></i>ساخت FakeTLS
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal for FakeTLS Logs -->
<div class="modal fade" id="fakeTLSLogsModal" tabindex="-1">
    <div class="modal-dialog modal-xl">
        <div class="modal-content modal-content-glass">
            <div class="modal-header modal-header-glass">
                <h5 class="modal-title fw-bold">
                    <i class="fas fa-file-alt me-2"></i>FakeTLS Logs
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="bg-dark rounded-3 p-3" style="max-height: 500px; overflow-y: auto;">
                    <pre id="fakeTLSLogsContent" class="text-light mb-0"><code>Loading logs...</code></pre>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-glow" data-bs-dismiss="modal">بستن</button>
                <button type="button" class="btn btn-primary btn-glow" onclick="refreshFakeTLSLogs()">
                    <i class="fas fa-sync me-2"></i>تازه‌سازی
                </button>
            </div>
        </div>
    </div>
</div>

<script>
// Enhanced JavaScript functions
function stopProxy(id) {
    if (confirm('آیا از توقف این پروکسی اطمینان دارید؟')) {
        fetch(`/proxy/stop/${id}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('خطا در توقف پروکسی: ' + data.message);
                }
            })
            .catch(error => {
                alert('خطا در ارتباط با سرور');
            });
    }
}

function startProxy(id) {
    fetch(`/proxy/start/${id}`, { method: 'POST' })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('خطا در راه‌اندازی پروکسی: ' + data.message);
            }
        })
        .catch(error => {
            alert('خطا در ارتباط با سرور');
        });
}

function restartProxy(id) {
    if (confirm('آیا از ریستارت این پروکسی اطمینان دارید؟')) {
        fetch(`/proxy/restart/${id}`, { method: 'POST' })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    alert('خطا در ریستارت پروکسی: ' + data.message);
                }
            })
            .catch(error => {
                alert('خطا در ارتباط با سرور');
            });
    }
}

function deleteProxy(id) {
    if (confirm('آیا از حذف این پروکسی اطمینان دارید؟ این عمل غیرقابل بازگشت است.')) {
        window.location.href = `/proxy/delete/${id}`;
    }
}

function editProxy(id) {
    window.location.href = `/proxy/edit/${id}`;
}

function viewFakeTLSLogs(proxyId) {
    currentLogProxyId = proxyId;
    document.getElementById('fakeTLSLogsContent').textContent = 'Loading logs...';
    
    fetch(`/proxy-enhanced/get-faketls-logs/${proxyId}`)
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                document.getElementById('fakeTLSLogsContent').textContent = data.logs;
            } else {
                document.getElementById('fakeTLSLogsContent').textContent = 'Error loading logs: ' + data.message;
            }
        })
        .catch(error => {
            document.getElementById('fakeTLSLogsContent').textContent = 'Error loading logs';
        });
    
    new bootstrap.Modal(document.getElementById('fakeTLSLogsModal')).show();
}

function refreshFakeTLSLogs() {
    if (currentLogProxyId) {
        viewFakeTLSLogs(currentLogProxyId);
    }
}

// Auto-refresh every 30 seconds
setInterval(function() {
    // You can add auto-refresh logic here if needed
}, 30000);

// Initialize tooltips
document.addEventListener('DOMContentLoaded', function() {
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
});
</script>
{% endblock %}